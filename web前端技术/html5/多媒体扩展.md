# 多媒体扩展

html作为展示用的前端协议,最主要的作用就是展示内容了,而在现在这个富媒体时代,
html5添加了大量的多媒体支持主要包括平面显示的画板和svg,音频的audio标签和webAudio,视频的video标签,
以及调用摄像头和麦克风的WebRTC,和调用GPU的webgl

而现在正在研发阶段的基于webgl的webVR和webAR也是非常值得关注的技术


## 画板`<canvas>`标签

画板标签估计是最为人所知的html5特性了,有了它,网页端的动画效果就可以不再依赖flash.也有许多网页游戏现在都是依赖画板标签的,而对于数据科学家来说,画板也是很好的可视化工具.
这里有一个[canvas教程](https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial),可以算很官方了.
canvas如果不是要写一些非常复杂的东西不推荐用框架,因为往往框架会限制适用领域
画板除了可以展现静态的图形,还可以有事件触发,有动画效果等

## SVG`<svg>`标签

svg是一种矢量图形格式,如果你以文本的形式打开可以看到他的本质是一个xml,html5现在支持直接使用`<svg>`标签嵌入svg,由于其xml的本质,于是也诞生了一些优秀的框架

### d3.js

d3.js是一个伟大的前端工具,这个会单独有个专题

## 音频`<audio>`标签和视频`<video>`标签

### audio标签

audio目前支持的格式有ogg和mp3


audio标签可以允许播放音频文件,它有这么几个属性

+ autoplay 如果出现该属性，则音频在就绪后马上播放。
+ controls	如果出现该属性，则向用户显示控件，比如播放按钮。
+ loop 如果出现该属性，则每当音频结束时重新开始播放。
+ preload
如果出现该属性，则音频在页面加载时进行加载，并预备播放。
如果使用 "autoplay"，则忽略该属性。
+ src 要播放的音频的 URL


### video标签

video标签目前支持的视频格式有:

+ Ogg = 带有 Theora 视频编码和 Vorbis 音频编码的 Ogg 文件
+ MPEG4 = 带有 H.264 视频编码和 AAC 音频编码的 MPEG 4 文件
+ WebM = 带有 VP8 视频编码和 Vorbis 音频编码的 WebM 文件


video标签的属性有:
+ autoplay	如果出现该属性，则视频在就绪后马上播放。
+ controls	如果出现该属性，则向用户显示控件，比如播放按钮。
+ loop	如果出现该属性，则当媒介文件完成播放后再次开始播放。
+ preload	 如果出现该属性，则视频在页面加载时进行加载，并预备播放。
如果使用 "autoplay"，则忽略该属性。
+ src	要播放的视频的 URL。
+ width	设置视频播放器的宽度。
+ height    设置视频播放器的高度。


### 在js中有的媒体操作

播放操作:

+ addTextTrack()	向音频/视频添加新的文本轨道
+ canPlayType()	检测浏览器是否能播放指定的音频/视频类型
+ load()	重新加载音频/视频元素
+ play()	开始播放音频/视频
+ pause()	暂停当前播放的音频/视频

设置操作

+ autoplay	设置或返回是否在加载完成后随即播放音频/视频
+ currentTime	设置或返回音频/视频中的当前播放位置（以秒计）
+ defaultMuted	设置或返回音频/视频默认是否静音
+ defaultPlaybackRate	设置或返回音频/视频的默认播放速度
+ loop	设置或返回音频/视频是否应在结束时重新播放
+ muted	设置或返回音频/视频是否静音
+ playbackRate	设置或返回音频/视频播放的速度
+ preload	设置或返回音频/视频是否应该在页面加载后进行加载
+ volume	设置或返回音频/视频的音量

获取状态:

+ duration	返回当前音频/视频的长度（以秒计）
+ ended	返回音频/视频的播放是否已结束
+ played	返回表示音频/视频已播放部分的 TimeRanges 对象
+ startDate 返回表示当前时间偏移的 Date 对象

### 事件

+ abort	当音频/视频的加载已放弃时
+ canplay	当浏览器可以播放音频/视频时
+ canplaythrough	当浏览器可在不因缓冲而停顿的情况下进行播放时
+ durationchange	当音频/视频的时长已更改时
+ emptied	当目前的播放列表为空时
+ ended	当目前的播放列表已结束时
+ error	当在音频/视频加载期间发生错误时
+ loadeddata	当浏览器已加载音频/视频的当前帧时
+ loadedmetadata	当浏览器已加载音频/视频的元数据时
+ loadstart	当浏览器开始查找音频/视频时
+ pause	当音频/视频已暂停时
+ play	当音频/视频已开始或不再暂停时
+ playing	当音频/视频在已因缓冲而暂停或停止后已就绪时
+ progress	当浏览器正在下载音频/视频时
+ ratechange	当音频/视频的播放速度已更改时
+ seeked	当用户已移动/跳跃到音频/视频中的新位置时
+ seeking	当用户开始移动/跳跃到音频/视频中的新位置时
+ stalled	当浏览器尝试获取媒体数据，但数据不可用时
+ suspend	当浏览器刻意不获取媒体数据时
+ timeupdate	当目前的播放位置已更改时
+ volumechange	当音量已更改时
+ waiting	当视频由于需要缓冲下一帧而停止

## Web Audio


[WebAudio](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API) 主要是为音频文件添加音效而设计的，但是它也可以用来播放音频文件，这类似于HTML5 audio元素的功能，只是audio元素可以有控制界面，用户可以点击界面上的播放/停止按钮来控制文件的播放，也可以拖动界面上的进度条来控制播放进度。而采用WebAudio API实现的音频播放则没有控制界面,他的功能更多的是处理音频.


感兴趣的话可以看这个项目<https://github.com/mdn/voice-change-o-matic>


## WebRTC


[WebRTC](https://webrtc.org/)是一项革命性的技术([api](http://w3c.github.io/webrtc-pc/)),它允许浏览器调用摄像头,麦克风.这样可以做一些比如自拍,录像这样的功能,获取摄像头和麦的捕捉信息由`navigator.mediaDevices.getUserMedia(c:Constraints)`对象获得,它通过参数对象<Constraints>来设置要捕获的流种类.

```ts
interface Constraints {
    audio: boolean||Object
    video: boolean||Object
}
```
它会返回一个promise,如果成功,就会获得一个`Stream`,失败就会返回一个`error`

### 设备选择

Constraints的内容中可以允许指定输出设备(用设备id),

```
constraints = {
    audio: { deviceId: audioSource ? { exact: audioSource } : undefined },
    video: { deviceId: videoSource ? { exact: videoSource } : undefined }
};
```

视屏输出的音频输出设备可以用`<HTMLVideoElement>.setSinkId(deviceId)`来指定.

可以用`navigator.mediaDevices.enumerateDevices()`收集系统上可用的媒体输入和输出设备的信息(deviceInfo[]),之后用then中的回调函数选择用哪个,放在一个容器中,

每个deviceInfo会包含有:

+ deviceId,设备编号
+ kind ,设备类型,包括audioinput,audiooutput,videoinput
+ label ,设备标签

这样只要将这些获得的deviceId放在指定的位置就可以自由的调换设备了


## WebGL

webgl是浏览器上的opengl,它可以直接操作gpu进行运算渲染,然后渲染到canvas或者其他什么上面

webgl相当底层,并不适合没有opengl基础的人,不过有[three.js](https://github.com/mrdoob/three.js),这个框架可以大大简化webgl的开发.关于three.js,我们也会专门开个系列

### WebVR`*`

[webvr](https://github.com/w3c/webvr)是目前正在初始阶段的新标准之一,它基于webgl的,可以关注,three.js有相关的例子不过我的浏览器似乎都还不支持

### WebAR`*`

[webar](https://github.com/jeromeetienne/threex.webar)也是webgl的扩展,是为了实现web端的ar功能,不过它连标准都不是,个人觉得ar是比vr有前途的多的新技术,可以适当关注,官方的例子我可以运行
